<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trial Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .header h1 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
        }
        .nav-tab {
            padding: 15px 25px;
            background: #f0f0f0;
            border: 2px solid #d0d0d0;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #666;
        }
        .nav-tab:hover {
            background: #e8e8e8;
            border-color: #bbb;
            color: #333;
        }
        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            border-color: transparent;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .initial-question {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .day-container {
            border: 2px solid #2c5aa0;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .day-header {
            background: #2c5aa0;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 6px 6px 0 0;
            font-weight: bold;
            font-size: 18px;
        }
        .classes-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        .class-container {
            border: 1px solid #28a745;
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            background: #f8fff8;
        }
        .class-header {
            background: #28a745;
            color: white;
            padding: 8px 12px;
            margin: -15px -15px 15px -15px;
            border-radius: 4px 4px 0 0;
            font-weight: bold;
        }
        .rounds-section {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 3px solid #007bff;
        }
        .form-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .label {
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* Typeahead dropdown styles */
        .typeahead-container {
            position: relative;
            display: inline-block;
        }
        .typeahead-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 250px;
        }
        .typeahead-input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .typeahead-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        .typeahead-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        .typeahead-item:hover, .typeahead-item.highlighted {
            background: #f8f9fa;
        }
        .typeahead-item:last-child {
            border-bottom: none;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        input[type="number"] { width: 100px; }
        input[type="text"] { width: 250px; }
        input[type="date"] { width: 180px; }
        input[type="email"] { width: 250px; }
        input[type="password"] { width: 250px; }
        select { width: 250px; }
        textarea { width: 100%; min-height: 150px; resize: vertical; }
        .yellow-highlight {
            background-color: #ffff99 !important;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        .data-upload {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .entry-form-link {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-block;
            margin: 20px 0;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .entry-form-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
            text-decoration: none;
            color: white;
        }
        .entry-link-message {
            background: #e8f5e8;
            border: 2px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .entry-link-message h4 {
            color: #28a745;
            margin-bottom: 15px;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .results-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            vertical-align: top;
        }
        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: top;
        }
        .results-table tr:hover {
            background: #f8f9fa;
        }
        .entry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .day-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }
        .day-group-header {
            font-weight: bold;
            font-size: 16px;
            color: #2c5aa0;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #2c5aa0;
        }
        .class-group {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .class-group-header {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }
        .trial-option {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .trial-option:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .trial-option label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .entry-type-options {
            display: flex;
            gap: 15px;
            margin-left: 20px;
        }
        .entry-type-options label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        /* Results display improvements */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .result-column {
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .column-header {
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-align: center;
        }
        .column-date {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .column-judge {
            font-size: 14px;
            margin-bottom: 5px;
        }
        .column-class-round {
            font-size: 14px;
        }
        .column-entries {
            padding: 15px;
        }
        .entry-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        .entry-item:last-child {
            border-bottom: none;
        }
        .entry-type-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        .badge-regular {
            background: #28a745;
            color: white;
        }
        .badge-feo {
            background: #ffc107;
            color: #333;
        }
        
        /* Login specific styles */
        .login-form-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 30px auto;
        }
        
        /* Dashboard styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .dashboard-card h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        /* Admin specific styles */
        .admin-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .admin-section h3 {
            color: #856404;
            margin-top: 0;
        }

        /* Score Sheet Print Styles */
        .score-sheet {
            page-break-after: always;
            background: white;
            padding: 0.75in 0.5in;
            font-family: Arial, sans-serif;
            font-size: 12px;
            width: 8.5in;
            height: 11in;
            margin: 0;
            box-sizing: border-box;
            position: relative;
        }
        .score-sheet:last-child {
            page-break-after: auto;
        }
        .score-sheet-header {
            margin-bottom: 25px;
            position: relative;
        }
        .score-sheet-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        .score-sheet-date {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 12px;
        }
        .score-sheet-class {
            font-size: 12px;
            font-weight: bold;
            margin: 15px 0 10px 0;
        }
        .score-sheet-round {
            display: flex;
            align-items: center;
            margin: 15px 0;
            font-size: 12px;
            font-weight: bold;
        }
        .round-label {
            margin-right: 15px;
        }
        .round-boxes {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .round-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #000;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        .round-number {
            font-size: 12px;
            margin-left: 3px;
        }
        .scent-header-section {
            margin: 20px 0;
        }
        .scent-header-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            border: 2px solid #000;
        }
        .scent-box {
            border-right: 1px solid #000;
            padding: 25px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            background: white;
        }
        .scent-box:last-child {
            border-right: none;
        }
        .scent-location-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            border: 2px solid #000;
            border-top: none;
        }
        .scent-location {
            border-right: 1px solid #000;
            padding: 15px 8px;
            font-size: 10px;
            min-height: 20px;
        }
        .scent-location:last-child {
            border-right: none;
        }
        .faults-section {
            font-size: 10px;
            margin: 15px 0;
            line-height: 1.3;
        }
        .scoring-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #000;
            margin-top: 15px;
            font-size: 9px;
        }
        .scoring-table th,
        .scoring-table td {
            border: 1px solid #000;
            text-align: center;
            vertical-align: middle;
            padding: 3px 1px;
        }
        .scoring-table th {
            font-weight: bold;
            font-size: 8px;
        }
        .team-header {
            width: 80px;
            font-size: 9px;
            line-height: 1.1;
        }
        .team-cell {
            width: 80px;
            font-size: 9px;
            line-height: 1.1;
            height: 35px;
            vertical-align: middle;
        }
        .scent-header-cell {
            width: 20px;
            font-size: 7px;
            line-height: 1;
            padding: 2px 1px;
        }
        .scent-data-cell {
            width: 20px;
            font-size: 7px;
            height: 35px;
        }
        .fault-time-header {
            width: 35px;
            font-size: 8px;
        }
        .fault-time-cell {
            width: 35px;
            height: 35px;
        }
        .copyright-bottom {
            position: absolute;
            bottom: 0.5in;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
        }
        @media print {
            body { 
                margin: 0 !important; 
                padding: 0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .container, #mainApp, #scoreSheetContainer { 
                background: none !important; 
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 !important;
                max-width: none !important;
            }
            .score-sheet {
                margin: 0 !important;
                padding: 0.75in 0.5in !important;
                box-shadow: none !important;
                transform: none !important;
            }
            @page {
                margin: 0;
                size: letter;
            }
        }
    </style>
</head>
<body>
   <div class="container">
       <!-- Site Host Admin Panel -->
       <div id="adminSection" class="admin-section" style="display: none;">
           <h3>üõ†Ô∏è Site Host Admin Panel</h3>
           <div class="dashboard-grid">
               <div class="dashboard-card">
                   <h4>Registered Clubs</h4>
                   <div id="allClubsList">No clubs registered</div>
                   <button onclick="exportAllClubData()" style="margin-top: 15px; width: 100%;">Export All Club Data</button>
               </div>
               <div class="dashboard-card">
                   <h4>All Trial Entries</h4>
                   <div id="allEntriesList">No entries</div>
                   <button onclick="exportAllTrialData()" style="margin-top: 15px; width: 100%;">Export All Trial Data</button>
               </div>
           </div>
           <div style="text-align: center; margin-top: 20px;">
               <button onclick="hideAdminPanel()">Exit Admin Panel</button>
           </div>
       </div>

       <!-- Login Section -->
       <div id="loginSection" class="header" style="display: block;">
           <h1>Trial Management System</h1>
           <p>Multi-Club Trial Management Platform</p>
           
           <!-- Admin Access Button -->
           <div style="text-align: center; margin-bottom: 20px;">
               <button onclick="showAdminPanel()" style="background: linear-gradient(45deg, #dc3545, #c82333); font-size: 12px; padding: 8px 15px;">Site Host Admin Access</button>
           </div>
           
           <div class="login-form-container">
               <div class="nav-tabs" style="margin-bottom: 20px;">
                   <button class="nav-tab active" onclick="showLoginTab('login')">Sign In</button>
                   <button class="nav-tab" onclick="showLoginTab('register')">Register Club</button>
               </div>
               
               <!-- Sign In Form -->
               <div id="loginForm" class="tab-content active">
                   <h3 style="text-align: center; margin-bottom: 25px;">Secretary Sign In</h3>
                   <form onsubmit="handleLogin(event)">
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Club Name:</label>
                           <input type="text" id="loginClubName" placeholder="Enter your club name" required style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Secretary Name:</label>
                           <input type="text" id="loginSecretaryName" placeholder="Enter your name" required style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Password:</label>
                           <input type="password" id="loginPassword" placeholder="Enter password" required style="width: 100%; margin-bottom: 20px;">
                       </div>
                       <div class="form-group" style="justify-content: center;">
                           <button type="submit">Sign In</button>
                       </div>
                   </form>
               </div>
               
               <!-- Register Form -->
               <div id="registerForm" class="tab-content">
                   <h3 style="text-align: center; margin-bottom: 25px;">Register New Club</h3>
                   <form onsubmit="handleRegister(event)">
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Club Name:</label>
                           <input type="text" id="registerClubName" placeholder="Enter club name" required style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Secretary Name:</label>
                           <input type="text" id="registerSecretaryName" placeholder="Enter secretary name" required style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Email:</label>
                           <input type="email" id="registerEmail" placeholder="Enter email address" required style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Password:</label>
                           <input type="password" id="registerPassword" placeholder="Create password (min 6 characters)" required minlength="6" style="width: 100%; margin-bottom: 15px;">
                       </div>
                       <div class="form-group" style="flex-direction: column; align-items: stretch;">
                           <label class="label">Confirm Password:</label>
                           <input type="password" id="registerConfirmPassword" placeholder="Confirm password" required style="width: 100%; margin-bottom: 20px;">
                       </div>
                       <div class="form-group" style="justify-content: center;">
                           <button type="submit">Register Club</button>
                       </div>
                   </form>
               </div>
           </div>
       </div>

       <!-- Main Application -->
       <div id="mainApp" style="display: none;">
           <div class="header">
               <h1>Trial Management System</h1>
               <div style="display: flex; justify-content: space-between; align-items: center;">
                   <p>Track judges across multiple days, classes, and rounds</p>
                   <div style="text-align: right;">
                       <div style="color: #667eea; font-weight: bold; margin-bottom: 5px;" id="clubInfo"></div>
                       <div style="font-size: 14px; color: #666;" id="secretaryInfo"></div>
                       <button onclick="logout()" style="margin-top: 10px; padding: 8px 15px; font-size: 12px;">Sign Out</button>
                   </div>
               </div>
           </div>

           <div class="nav-tabs">
               <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
               <button class="nav-tab" onclick="showTab('setup')">Trial Setup</button>
               <button class="nav-tab" onclick="showTab('entry')">Entry Form</button>
               <button class="nav-tab" onclick="showTab('edit')">Edit Entry</button>
               <button class="nav-tab" onclick="showTab('results')">Results</button>
           </div>

           <!-- Dashboard Tab -->
           <div id="dashboard" class="tab-content active">
               <div class="initial-question">
                   <h3>Club Dashboard</h3>
                   <div id="dashboardContent">
                       <div class="dashboard-grid">
                           <div class="dashboard-card">
                               <h4>Active Trials</h4>
                               <div id="activeTrials">No active trials</div>
                           </div>
                           <div class="dashboard-card">
                               <h4>Recent Entries</h4>
                               <div id="recentEntries">No recent entries</div>
                           </div>
                           <div class="dashboard-card">
                               <h4>Club Settings</h4>
                               <div>
                                   <button onclick="showWaiverSettings()" style="width: 100%; margin-bottom: 10px;">Customize Waiver Text</button>
                                   <button onclick="exportTrialDocument()" style="width: 100%; margin-bottom: 10px;">Export Trial for Approval</button>
                               </div>
                           </div>
                           <div class="dashboard-card">
                               <h4>Quick Actions</h4>
                               <div>
                                   <button onclick="showTab('setup')" style="width: 100%; margin-bottom: 10px;">Create New Trial</button>
                                   <button onclick="showTab('results')" style="width: 100%; margin-bottom: 10px;">View All Results</button>
                                   <button onclick="showPrintScoreSheets()" style="width: 100%; margin-bottom: 10px;">Print Score Sheets</button>
                                   <button onclick="printTrialSummary()" style="width: 100%; margin-bottom: 10px;">Print Trial Summary</button>
                                   <button onclick="exportAllData()" style="width: 100%;">Export All Data</button>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>

           <!-- Setup Tab -->
           <div id="setup" class="tab-content">
               <!-- Waiver Settings -->
               <div id="waiverSettings" style="display: none; background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                   <h3>Customize Club Waiver Text</h3>
                   <div class="form-group" style="flex-direction: column; align-items: stretch;">
                       <label class="label">Waiver Text for Your Club:</label>
                       <textarea id="clubWaiverText" placeholder="Enter your club's liability waiver text here..." style="width: 100%; height: 200px;"></textarea>
                   </div>
                   <div class="form-group">
                       <button onclick="saveWaiverText()">Save Waiver Text</button>
                       <button onclick="hideWaiverSettings()">Cancel</button>
                   </div>
               </div>

               <div class="data-upload">
                   <h3>Data Management</h3>
                   <div class="form-group">
                       <label class="label">Upload JSON Data:</label>
                       <input type="file" id="jsonFile" accept=".json" onchange="loadJSONData()">
                   </div>
                   <div id="dataStatus"></div>
               </div>

               <div class="initial-question">
                   <div class="form-group">
                       <span class="label">How many days in trial?</span>
                       <input type="number" id="trialDays" min="1" max="30" placeholder="Enter number">
                       <button onclick="generateDays()">Generate Days</button>
                   </div>
               </div>

               <div id="daysContainer"></div>
               <div id="entryFormLink" style="display: none; margin-top: 20px; padding: 20px; background: #e8f4f8; border-radius: 8px; text-align: center;">
                   <h3 style="color: #2c5aa0;">Trial Setup Complete!</h3>
                   <p>Your trial has been configured. You can now:</p>
                   <div style="margin: 15px 0;">
                       <button onclick="exportTrialDocument()" style="margin-right: 10px;">Export Trial Document for Approval</button>
                       <button onclick="showEntryForm()">Preview Entry Form</button>
                   </div>
                   <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; border: 1px solid #ffc107;">
                       <h4 style="color: #856404; margin-top: 0;">Entry Form Link (For Publication After Approval):</h4>
                       <p style="font-size: 14px; color: #666; margin-bottom: 10px;">Share this link in your show premium once the trial is approved:</p>
                       <input type="text" id="entryFormUrl" readonly style="width: 100%; background: #f8f9fa;" value="[This would be your actual website URL with trial ID]">
                       <button onclick="copyEntryFormLink()" style="margin-top: 10px;">Copy Link</button>
                   </div>
               </div>
           </div>

           <!-- Entry Form Tab -->
           <div id="entry" class="tab-content">
               <div class="initial-question">
                   <h3>Dog Entry Form</h3>
                   <form id="entryForm">
                       <div class="form-group">
                           <span class="label">Registration Number:</span>
                           <div class="typeahead-container">
                               <input type="text" id="regNumber" class="typeahead-input" 
                                      placeholder="Type registration number" 
                                      onkeyup="handleRegNumberTypeahead(this)" 
                                      onblur="hideRegNumberDropdown()" 
                                      onfocus="showRegNumberDropdown()">
                               <div id="regNumberDropdown" class="typeahead-dropdown"></div>
                           </div>
                           <span id="callName" style="font-weight: bold; color: #667eea;"></span>
                       </div>
                       
                       <div class="form-group">
                           <span class="label">Handler:</span>
                           <input type="text" id="handlerName" placeholder="Enter handler name" required>
                       </div>

                       <div class="form-group">
                           <span class="label">Email Address:</span>
                           <input type="email" id="handlerEmail" placeholder="Enter email address" required>
                       </div>

                       <div id="trialOptionsContainer">
                           <h4>Available Trial Options</h4>
                           <div id="trialOptions"></div>
                       </div>

                       <div class="form-group" style="flex-direction: column; align-items: flex-start; margin: 20px 0;">
                           <div id="waiverDisplay" style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 15px; max-height: 200px; overflow-y: auto; font-size: 12px; line-height: 1.4;">
                               <h4 style="margin-top: 0; color: #495057;">LIABILITY WAIVER AND AGREEMENT</h4>
                               <div id="waiverContent">
                                   <p>I/we acknowledge that I am/we are familiar with the current rules applying to Canine-Work and Games Trials. I/we agree that the Host holding the Trial, Marla Williamson or any other officiate at trial, has the right to refuse entry for cause which the Host shall deem to be sufficient.</p>
                                   
                                   <p>Upon acceptance of this entry, I/we agree to hold Canine-Work And Games, LLC, and its members and officers, this Host, its members, directors, officers agents, show secretary, show chairperson, show committee and the owner or lessor of the premises and any employees of the aforementioned parties, any sponsors of this event, harmless from any claim or loss or injury which may be alleged to have been caused directly or indirectly to any person or thing by the act of this dog or handler while in or upon the show trial premises or grounds or near any entrance thereto.</p>
                                   
                                   <p>I/we further agree to hold the aforementioned parties harmless from any claim or loss of this dog by disappearance, theft, death or otherwise, and from any claim for damage or injury to the dog, whether any claim be caused or alleged to be caused by the negligence of the Host or any of the parties aforementioned, or by the negligence of any other person, or any other cause or causes.</p>
                                   
                                   <p>I/we hereby assume sole responsibility for, and agree to indemnify and save the aforementioned parties harmless from, any and all loss and expense (including legal fees) by reason of the liability imposed by law upon any of the aforementioned parties for damage because of bodily injuries, including death at any time resulting from, or sustained by any person or persons, including myself/ourselves or on account of damage to property, arising out of or in consequence of my/our participation in the Trial, howsoever such injuries, death or damage to property may be caused and whether or not the same may have been caused by negligence of the aforementioned parties or any of their employees or agents, or any other persons.</p>
                                   
                                   <p><strong>I/we agree to abide by the rules of C-WAGS currently in effect at the time of the trial. I/we testify that the dog entered is healthy and vaccinated or tittered. I/we certify that the dog entered is not dangerous to any person or other dog.</strong></p>
                               </div>
                           </div>
                           
                           <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; font-weight: bold;">
                               <input type="checkbox" id="waiverAccepted" required style="margin-top: 4px; transform: scale(1.2);">
                               <span>I have read and agree to the above Liability Waiver and Agreement. This agreement must be accepted for a valid entry.</span>
                           </label>
                       </div>

                       <div class="form-group">
                           <button type="submit">Submit Entry</button>
                           <button type="button" onclick="clearForm()">Clear Form</button>
                       </div>
                   </form>
               </div>
           </div>

           <!-- Edit Entry Tab -->
           <div id="edit" class="tab-content">
               <div class="initial-question">
                   <h3>Edit Entry</h3>
                   <div class="form-group">
                       <span class="label">Search by Registration Number or Handler Name:</span>
                       <input type="text" id="searchEntry" placeholder="Enter registration number or handler name" onkeyup="searchEntries()" style="width: 300px;">
                   </div>
                   <div id="searchResults" style="margin-top: 20px;"></div>
               </div>
           </div>

           <!-- Results Tab -->
           <div id="results" class="tab-content">
               <div class="initial-question">
                   <h3>Entry Results</h3>
                   <button onclick="exportToCSV()">Export to CSV</button>
                   <button onclick="printTrialSummary()" style="margin-left: 10px;">Print Trial Summary</button>
                   <div id="resultsDisplay"></div>
               </div>
           </div>
       </div>
   </div>

   <!-- Print Score Sheets Modal -->
   <div id="printModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
       <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
           <h3>Print Score Sheets</h3>
           <p>Select a trial date to generate score sheets:</p>
           <div id="dateSelectionList" style="max-height: 300px; overflow-y: auto; margin: 20px 0;"></div>
           <div style="text-align: center; margin-top: 20px;">
               <button onclick="closePrintModal()" style="margin-right: 10px;">Cancel</button>
           </div>
       </div>
   </div>

   <!-- Entry Confirmation Modal -->
   <div id="confirmationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
       <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%;">
           <h3 style="color: #28a745;">Entry Submitted Successfully! ‚úÖ</h3>
           <div id="confirmationContent"></div>
           <div style="text-align: center; margin-top: 20px;">
               <button onclick="closeConfirmationModal()" style="margin-right: 10px;">Close</button>
               <button onclick="printConfirmation()">Print Confirmation</button>
           </div>
           <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin-top: 15px; font-size: 14px;">
               <strong>üìß Email Confirmation:</strong> In a live system, a confirmation email would be automatically sent to <span id="confirmationEmail"></span>
           </div>
       </div>
   </div>

   <!-- Score Sheet Print Area -->
   <div id="scoreSheetContainer" style="display: none;"></div>

   <script>
       // Global data storage
       let dogData = [];
       let availableClasses = [];
       let availableJudges = [];
       let trialConfig = [];
       let entryResults = [];
       let totalDays = 0;
       let savedDays = 0;
       let currentUser = null;
       let registeredClubs = [];
       let allTrialData = []; // Store all trials from all clubs

       // Print Trial Summary Function
       function printTrialSummary() {
           const w = window.open('', '_blank');
           w.document.write(`<html><head><title>Trial Summary</title><style>body{font-family:Arial;padding:1in;font-size:12px;}table{border-collapse:collapse;width:100%;margin:10px 0;}th,td{border:1px solid black;padding:5px;text-align:left;}h1,h2{text-align:center;}</style></head><body><h1>TRIAL SUMMARY - ${currentUser.clubName}</h1><h2>Entries: ${entryResults.length} | Dogs: ${[...new Set(entryResults.map(e => e.regNumber))].length} | Handlers: ${[...new Set(entryResults.map(e => e.handler))].length}</h2><table><tr><th>Dog</th><th>Handler</th><th>Date</th><th>Class</th><th>Round</th><th>Judge</th><th>Type</th></tr>${entryResults.map(e => `<tr><td>${e.callName}</td><td>${e.handler}</td><td>${e.date}</td><td>${e.className}</td><td>${e.round}</td><td>${e.judge}</td><td>${e.entryType}</td></tr>`).join('')}</table></body></html>`);
           w.document.close(); w.print(); w.close();
       }

       // Admin Functions
       function showAdminPanel() {
           document.getElementById('loginSection').style.display = 'none';
           document.getElementById('adminSection').style.display = 'block';
           updateAdminPanel();
       }

       function hideAdminPanel() {
           document.getElementById('adminSection').style.display = 'none';
           document.getElementById('loginSection').style.display = 'block';
       }

       function updateAdminPanel() {
           // Display all registered clubs
           const clubsList = document.getElementById('allClubsList');
           if (registeredClubs.length === 0) {
               clubsList.innerHTML = 'No clubs registered';
           } else {
               let html = '<div style="max-height: 200px; overflow-y: auto;">';
               registeredClubs.forEach((club, index) => {
                   html += `
                       <div style="padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 5px; background: #f9f9f9;">
                           <strong>${club.clubName}</strong><br>
                           Secretary: ${club.secretaryName}<br>
                           Email: ${club.email}<br>
                           Registered: ${new Date(club.registrationDate).toLocaleDateString()}
                       </div>
                   `;
               });
               html += '</div>';
               clubsList.innerHTML = html;
           }

           // Display all entries from all clubs
           const entriesList = document.getElementById('allEntriesList');
           if (allTrialData.length === 0) {
               entriesList.innerHTML = 'No entries';
           } else {
               const totalEntries = allTrialData.reduce((sum, trial) => sum + trial.entries.length, 0);
               entriesList.innerHTML = `<strong>${totalEntries}</strong> total entries across <strong>${allTrialData.length}</strong> trials`;
           }
       }

       function exportAllClubData() {
           if (registeredClubs.length === 0) {
               alert('No club data to export');
               return;
           }

           let csv = 'Club Name,Secretary Name,Email,Registration Date\n';
           registeredClubs.forEach(club => {
               csv += `"${club.clubName}","${club.secretaryName}","${club.email}","${club.registrationDate}"\n`;
           });

           downloadFile(csv, 'all_clubs_data.csv', 'text/csv');
       }

       function exportAllTrialData() {
           if (allTrialData.length === 0) {
               alert('No trial data to export');
               return;
           }

           let csv = 'Club Name,Registration,Call Name,Handler,Email,Date,Class,Round,Judge,Entry Type,Timestamp\n';
           allTrialData.forEach(trial => {
               trial.entries.forEach(entry => {
                   csv += `"${trial.clubName}","${entry.regNumber}","${entry.callName}","${entry.handler}","${entry.email || ''}","${entry.date}","${entry.className}","${entry.round}","${entry.judge}","${entry.entryType}","${entry.timestamp}"\n`;
               });
           });

           downloadFile(csv, 'all_trial_data.csv', 'text/csv');
       }

       // Login/Authentication functions
       function showLoginTab(tabName) {
           document.querySelectorAll('#loginSection .tab-content').forEach(tab => {
               tab.classList.remove('active');
           });
           document.querySelectorAll('#loginSection .nav-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           document.getElementById(tabName + 'Form').classList.add('active');
           event.target.classList.add('active');
       }

       function handleLogin(event) {
           event.preventDefault();
           
           const clubName = document.getElementById('loginClubName').value;
           const secretaryName = document.getElementById('loginSecretaryName').value;
           const password = document.getElementById('loginPassword').value;

           // Simple authentication - in real app, this would be server-side
           const club = registeredClubs.find(c => 
               c.clubName === clubName && 
               c.secretaryName === secretaryName && 
               c.password === password
           );

           if (club) {
               currentUser = club;
               document.getElementById('loginSection').style.display = 'none';
               document.getElementById('mainApp').style.display = 'block';
               document.getElementById('clubInfo').textContent = club.clubName;
               document.getElementById('secretaryInfo').textContent = 'Secretary: ' + club.secretaryName;
               
               // Load club's waiver text if exists
               if (club.waiverText) {
                   document.getElementById('waiverContent').innerHTML = club.waiverText;
                   document.getElementById('clubWaiverText').value = club.waiverText;
               }
               
               updateDashboard();
           } else {
               alert('Invalid credentials. Please check your club name, secretary name, and password.');
           }
       }

       function handleRegister(event) {
           event.preventDefault();
           
           const clubName = document.getElementById('registerClubName').value;
           const secretaryName = document.getElementById('registerSecretaryName').value;
           const email = document.getElementById('registerEmail').value;
           const password = document.getElementById('registerPassword').value;
           const confirmPassword = document.getElementById('registerConfirmPassword').value;

           if (password !== confirmPassword) {
               alert('Passwords do not match');
               return;
           }

           // Check if club already exists
           if (registeredClubs.find(c => c.clubName === clubName)) {
               alert('Club name already exists');
               return;
           }

           // Register new club
           const newClub = {
               clubName,
               secretaryName,
               email,
               password,
               registrationDate: new Date().toISOString(),
               waiverText: null // Will be customized later
           };

           registeredClubs.push(newClub);
           alert('Club registered successfully! Please sign in.');
           showLoginTab('login');
       }

       function logout() {
           currentUser = null;
           document.getElementById('loginSection').style.display = 'block';
           document.getElementById('mainApp').style.display = 'none';
           
           // Clear login form
           document.getElementById('loginClubName').value = '';
           document.getElementById('loginSecretaryName').value = '';
           document.getElementById('loginPassword').value = '';
       }

       // Waiver Management
       function showWaiverSettings() {
           document.getElementById('waiverSettings').style.display = 'block';
           // Load current waiver text
           if (currentUser && currentUser.waiverText) {
               document.getElementById('clubWaiverText').value = currentUser.waiverText;
           }
       }

       function hideWaiverSettings() {
           document.getElementById('waiverSettings').style.display = 'none';
       }

       function saveWaiverText() {
           const waiverText = document.getElementById('clubWaiverText').value.trim();
           if (!waiverText) {
               alert('Please enter waiver text');
               return;
           }

           // Save to current user
           if (currentUser) {
               currentUser.waiverText = waiverText;
               
               // Update the club in the registered clubs array
               const clubIndex = registeredClubs.findIndex(c => c.clubName === currentUser.clubName);
               if (clubIndex !== -1) {
                   registeredClubs[clubIndex].waiverText = waiverText;
               }

               // Update the waiver display in entry form
               document.getElementById('waiverContent').innerHTML = waiverText;
               
               showStatusMessage('Waiver text saved successfully!', 'success');
               hideWaiverSettings();
           }
       }

       function updateDashboard() {
           // Update active trials
           let activeTrialsHtml = 'No active trials';
           if (trialConfig.length > 0) {
               const uniqueDates = [...new Set(trialConfig.map(t => t.date))];
               activeTrialsHtml = `<strong>${uniqueDates.length}</strong> trial days configured`;
           }
           document.getElementById('activeTrials').innerHTML = activeTrialsHtml;

           // Update recent entries
           let recentEntriesHtml = 'No recent entries';
           if (entryResults.length > 0) {
               const recentEntries = entryResults.slice(-3);
               recentEntriesHtml = recentEntries.map(entry => 
                   `<div style="margin-bottom: 8px;">${entry.callName} - ${entry.className}</div>`
               ).join('');
           }
           document.getElementById('recentEntries').innerHTML = recentEntriesHtml;
       }

       function exportAllData() {
           if (entryResults.length === 0) {
               alert('No data to export');
               return;
           }
           exportToCSV();
       }

       // Export Trial Document for Approval
       function exportTrialDocument() {
           if (trialConfig.length === 0) {
               alert('No trial configuration to export. Please set up your trial first.');
               return;
           }

           // Create a comprehensive trial document
           let document = `TRIAL APPLICATION DOCUMENT\n`;
           document += `=====================================\n\n`;
           document += `Club Information:\n`;
           document += `Club Name: ${currentUser.clubName}\n`;
           document += `Secretary: ${currentUser.secretaryName}\n`;
           document += `Email: ${currentUser.email}\n`;
           document += `Application Date: ${new Date().toLocaleDateString()}\n\n`;

           document += `Trial Configuration:\n`;
           document += `=====================================\n\n`;

           // Group by day
           const groupedByDay = {};
           trialConfig.forEach(config => {
               if (!groupedByDay[config.day]) {
                   groupedByDay[config.day] = {};
               }
               if (!groupedByDay[config.day][config.className]) {
                   groupedByDay[config.day][config.className] = [];
               }
               groupedByDay[config.day][config.className].push(config);
           });

           // Sort days numerically
           const sortedDays = Object.keys(groupedByDay).sort((a, b) => parseInt(a) - parseInt(b));
           
           sortedDays.forEach(day => {
               const dayConfig = groupedByDay[day];
               const firstClass = Object.keys(dayConfig)[0];
               const date = dayConfig[firstClass][0].date;
               
               document += `DAY ${day} - ${date}\n`;
               document += `${'='.repeat(30)}\n`;
               
               // Sort classes alphabetically
               const sortedClasses = Object.keys(dayConfig).sort();
               
               sortedClasses.forEach(className => {
                   document += `\nClass: ${className}\n`;
                   document += `${'‚îÄ'.repeat(20)}\n`;
                   
                   // Sort rounds
                   dayConfig[className].sort((a, b) => a.roundNum - b.roundNum);
                   
                   dayConfig[className].forEach(config => {
                       document += `  Round ${config.roundNum}: ${config.judge}\n`;
                   });
               });
               document += `\n`;
           });

           document += `\nTotal Trial Days: ${sortedDays.length}\n`;
           document += `Total Classes: ${[...new Set(trialConfig.map(c => c.className))].length}\n`;
           document += `Total Rounds: ${trialConfig.length}\n\n`;

           document += `=====================================\n`;
           document += `This trial application is submitted for approval.\n`;
           document += `Please review and approve for publication.\n`;
           document += `=====================================\n`;

           // Download as text file (could be enhanced to Word format with a library)
           downloadFile(document, `${currentUser.clubName}_Trial_Application.txt`, 'text/plain');
           showStatusMessage('Trial document exported! Send this to the organization for approval.', 'success');
       }

       function copyEntryFormLink() {
           const linkField = document.getElementById('entryFormUrl');
           linkField.select();
           linkField.setSelectionRange(0, 99999); // For mobile devices
           
           try {
               document.execCommand('copy');
               showStatusMessage('Entry form link copied to clipboard!', 'success');
           } catch (err) {
               alert('Could not copy link. Please manually select and copy the link.');
           }
       }

       // Tab management
       function showTab(tabName) {
           document.querySelectorAll('#mainApp .tab-content').forEach(tab => {
               tab.classList.remove('active');
           });
           document.querySelectorAll('#mainApp .nav-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           document.getElementById(tabName).classList.add('active');
           event.target.classList.add('active');
       }

       function showEntryForm() {
           showTab('entry');
       }

       // Typeahead functionality for registration numbers
       function handleRegNumberTypeahead(input) {
           const query = input.value.toLowerCase();
           const dropdown = document.getElementById('regNumberDropdown');
           
           if (query.length === 0) {
               dropdown.style.display = 'none';
               document.getElementById('callName').textContent = '';
               return;
           }

           const matches = dogData.filter(dog => 
               dog.regNumber.toLowerCase().includes(query)
           );

           if (matches.length > 0) {
               let html = '';
               matches.forEach(dog => {
                   html += `<div class="typeahead-item" onclick="selectRegNumber('${dog.regNumber}', '${dog.callName}')">${dog.regNumber} - ${dog.callName}</div>`;
               });
               dropdown.innerHTML = html;
               dropdown.style.display = 'block';

               // Auto-select if exact match
               const exactMatch = matches.find(dog => dog.regNumber.toLowerCase() === query);
               if (exactMatch) {
                   document.getElementById('callName').textContent = exactMatch.callName;
                   document.getElementById('callName').style.color = '#28a745';
               }
           } else {
               dropdown.style.display = 'none';
               document.getElementById('callName').textContent = 'Not found';
               document.getElementById('callName').style.color = '#dc3545';
           }
       }

       function selectRegNumber(regNumber, callName) {
           document.getElementById('regNumber').value = regNumber;
           document.getElementById('callName').textContent = callName;
           document.getElementById('callName').style.color = '#28a745';
           document.getElementById('regNumberDropdown').style.display = 'none';
       }

       function hideRegNumberDropdown() {
           setTimeout(() => {
               document.getElementById('regNumberDropdown').style.display = 'none';
           }, 200);
       }

       function showRegNumberDropdown() {
           const input = document.getElementById('regNumber');
           if (input.value.length > 0) {
               handleRegNumberTypeahead(input);
           }
       }

       // Load JSON data from file
       function loadJSONData() {
           const file = document.getElementById('jsonFile').files[0];
           if (!file) return;

           const reader = new FileReader();
           reader.onload = function(e) {
               try {
                   const data = JSON.parse(e.target.result);
                   if (Array.isArray(data) && data.length > 0) {
                       dogData = data;
                       
                       // Extract unique classes and judges from the data
                       availableClasses = [...new Set(data.map(item => item.className || item.class).filter(Boolean))];
                       availableJudges = [...new Set(data.map(item => item.judge).filter(Boolean))];
                       
                       showStatusMessage('JSON data loaded successfully!', 'success');
                   } else {
                       showStatusMessage('JSON file appears to be empty or invalid format', 'warning');
                   }
               } catch (error) {
                   showStatusMessage('Error parsing JSON file: ' + error.message, 'warning');
               }
           };
           reader.readAsText(file);
       }

       // Generate days (original flow)
       function generateDays() {
           const numDays = parseInt(document.getElementById('trialDays').value);
           if (!numDays || numDays < 1) {
               alert('Please enter a valid number of days');
               return;
           }

           totalDays = numDays;
           savedDays = 0;
           const container = document.getElementById('daysContainer');
           container.innerHTML = '';

           for (let i = 1; i <= numDays; i++) {
               createDaySection(i, container);
           }
       }

       function createDaySection(dayNum, container) {
           const dayDiv = document.createElement('div');
           dayDiv.className = 'day-container';
           dayDiv.innerHTML = `
               <div class="day-header">Day ${dayNum}</div>
               <div class="form-group">
                   <span class="label">Date for Day ${dayNum}:</span>
                   <input type="date" id="date_${dayNum}">
               </div>
               <div class="classes-section">
                   <div class="form-group">
                       <span class="label">How many classes this day?</span>
                       <input type="number" id="classes_${dayNum}" min="1" max="20" class="yellow-highlight" 
                              placeholder="Number" onchange="generateClasses(${dayNum})">
